<html>


<head>
<link href = "AnimalFeeder.css" rel = "stylesheet" type = "text/css"></link>
<script type = "text/javascript" src = "Jquery.js"> </script>
<script type = "text/javascript" src = "timer.js"></script>
<script type = "text/javascript" src = "Subject.js"></script>
</head>

<body>
<h1> Animal Feeder </h1>

<div id = "links">
<a href = "user.html">User Page</a>
</div>

<div id = "jungle"> 
	<div id = "animal1"><img src = "images/Animal_Feeder/lion.png" /></div>
	<div id = "animal2"><img src = "images/Animal_Feeder/zebra.png" /></div>
	<div id = "conBelt"><img src = "images/Animal_Feeder/converyorBelt.png" /></div>
	<div id = "paddle"><img src = "images/Animal_Feeder/paddle1.png" /></div>
	<div id = "food"><img src = "images/Animal_Feeder/steak.png" /></div>
</div>

<script type = "text/javascript">

//Functions

/* To keep in mind

Animal Key:

Giraffe: animalList == 0
Lion: animalList == 1
Gorilla:: animalList == 2
Wolf: animalList == 3

Food Key:

Corn : stim == 0 
Steak: stim == 1
Lettuce: stim == 2
Drumstick: stim == 3


*/

function nextLevel() {
	//stuff for making a new stimList etc...
	
	//settin\g of game variables - eventually should be retrieved from the database
	trial = 0;
	level = level + 1;
	stimList = [1, 2, 1, 1, 0, 3, 0, 2, 0, 3, 2, 3];
	animalList1 = [1, 0, 3, 2, 2, 2, 1, 3, 2, 1, 1, 1];
	animalList2 = [0, 3, 0, 1, 3, 0, 2, 2, 2, 0, 1, 0];
	
	//start things off
	stim = stimList[trial];
	animal1 = animalList1[trial];
	animal2 = animalList2[trial];
	
	//subject.inputLevelData(level, score, currentTime.getTime());
	subject.sendLevelData();
}
function nextTrial(vertPos,horPos) {

	//Move food back to its original position
	setVertPos(vertPos,"#food");
	setHorPos(horPos,"#food");

	//Increment trial number each time this function is called
	trial = trial + 1;
	
	stim = stimList[trial];
	food = stimFile[stim];
	animal1 = animalList1[trial];
	animal2 = animalList2[trial];
	creature1 = animalFile[animal1];
	creature2 = animalFile[animal2];
	
	$("#food").html("<img src = \"images/Animal_Feeder/" + food + ".png\" />");
	$("#animal1").html("<img src = \"images/Animal_Feeder/" +creature1+ ".png\" />");
	$("#animal2").html("<img src = \"images/Animal_Feeder/" +creature2+ ".png\" />");
	
	if (trial < stimList.length) { //Trial lasts until we run out of fruit 
		//Send to the server which object was sent to the user to be 'delt' with (steak or banana)
		stim = stimList[trial];
		subject.inputData(trial, "stim", stim);
		subject.inputData(trial, "stimFile", stimFile[stim]);
	}
	else {
		//alert('Level Complete');
		subject.sendData();
		nextLevel(stimFile, stimList);
	}
	
	key = 222; //default key value, used throughout program
	decisionPoint == 0; //default decision state
}

	//This function with govern the animation when the food is delivered (name pending)
function onDelivery(){
	
	if(decisionPoint == 1){	//goes to animal 1
		
		if ( $.inArray(creature1, rule[food]) != -1){
			
			$("#animal1").html("<img src = \"images/Animal_Feeder/"+creature1+ "_happy.png\" />");
			subject.inputData(trial,"outcome","P");}
			
		else { 
		
			$("#animal1").html("<img src = \"images/Animal_Feeder/"+creature1+" _angry.png\" />");
			subject.inputData(trial,"outcome","N");}
	}
	
	if(decisionPoint == 2){
		
		if ( $.inArray(creature2,rule[food]) != -1){
		
			$("#animal2").html("<img src = \"images/Animal_Feeder/"+creature2+ "_happy.png\" />");
			subject.inputData(trial,"outcome","P");}
		else {
		
			$("#animal2").html("<img src = \"images/Animal_Feeder/"+creature2+ "_angry.png\" />");
			subject.inputData(trial,"outcome","N");}
	}
}
	
//This function will govern the animal when no food is chosen, aka falls to the ground and splatters
function noFood(maxVert,speed){
		
	var position = $("#food").position();
		
	if(position.top < maxVert){
			moveObjVert(speed,"#food");}
		
	if(position.top >= maxVert){
		
		$("#animal1").html("<img src = \"images/Animal_Feeder/" + creature1 + "_angry.png\" />");
		$("#animal2").html("<img src = \"images/Animal_Feeder/" + creature2 + "_angry.png\" />");
		$("#food").html("<img src = \"images/Animal_Feeder/" + food + "_squashed.png\" />");
	}git 
}

function movePaddle(){
	
	if (key == 0){	
		$("#paddle").html("<img src = \"images/Animal_Feeder/paddle1.png\" />");}

	if (key == 1){	
		$("#paddle").html("<img src = \"images/Animal_Feeder/paddle2.png\" />");}
}

//A set of functions for moving objects
function setVertPos(v,id) {
	boxVPos = v;
	v = v + "px";
	$(id).css("top", v);
}
	
function moveObjVert(v,id) {//Move objects vertically. Negative v values move up, position move down
	boxVPos = boxVPos + v;
	newVPos = boxVPos + "px";
	$(id).css("top", newVPos);
}
function setHorPos(h,id){
	boxHPos = h;
	h = h + "px";
	$(id).css("right",h);
}
	
function moveObjHor(h,id){//Set direction of motion in horizonal dirction. Negative h makes the object move right. Positive the opposite.
	boxHPos = boxHPos + h;
	newHPos = boxHPos + "px";
	$(id).css("right",newHPos);
}

//Main Program
$(document).ready(function(){
	
	subject = new Subject(666,"animalFeeder");
	currentTime = new Date();
	
	//Set work Variables
	maxHorPos = 575;
	maxVertPos = 100;// How far down the conveyor belt food will go
	maxFallPos = 450;//How far unchosen food will fall
	
	landingMax = 20; //How long the landing animation will last
	landing = landingMax;
	
	decisionPoint = 0;//State variable, changes when user decides what to do with the food
	
	//Set start positions of food
	foodHStart = 800;
	foodVStart = 50;
	
	setVertPos(foodVStart,"#food");
	setHorPos(foodHStart,"#food");
	
	//Set end positions for food
	foodEnd1 = 380;
	foodEnd2 = 300;
	
	//Set game Variables-which will be retrieved from the server
	timeInc = 1;
	level = 0;
	trial = 0;
	stimList = [0, 1, 2, 3, 2, 0, 1, 3, 1, 2, 1, 0];
	animalList1 = [0, 2, 2, 1, 1, 0, 2, 1, 1, 0, 0, 1];
	animalList2 = [1, 3, 3, 0, 2, 3, 3, 0, 2, 1, 1, 0];
	stimFile = ["corn","steak","lettuce","drumstick"];
	animalFile = ["giraffe","lion","gorilla","wolf"];
	
	rule = new Array();
	
	rule['steak'] =  [ 'lion','wolf'];
	rule['corn'] = ['giraffe','gorilla'];
	rule['drumstick'] = ['lion','wolf'];
	rule['lettuce'] = ['giraffe','gorilla'];
	
	trialStart = currentTime.getTime();
	
	//Start things off
	stim = stimList[trial];
	food = stimFile[stim];
	animal1 = animalList1[trial];
	animal2 = animalList2[trial];
	creature1 = animalFile[animal1];
	creature2 = animalFile[animal2];
	
$.timer(40,function(timer){
	
	//Get current position; take css info and cast as int so we can work with it
	var posV = $("#food").position();
	positionV = posV.top;
	
	var positionH = $("#food").css("right");
	var posH = positionH.substr(0,3);
	newposH = parseInt(posH);

//Here are the statements which govern the moving of the food		
	
	//Phase 1: Move obj down the conveyor belt, angle is determined by the difference of vertical and horizontal speed(slope)
	if (newposH > maxHorPos && positionV < maxVertPos){
		moveObjVert(timeInc,"#food");
		moveObjHor(-timeInc - 3.5,"#food");
	
	//Phase 2: Three possibilities, go left, go right, or falls of the belt	
		if(key == 0){
			decisionPoint = 1;}
		
		if(key == 1){
			decisionPoint = 2;}
			
		if(key == 222){
			decisionPoint = 0;}
		}
	
	//Phase 3: execute decision
	else if (positionV >= maxVertPos){
	
		if (decisionPoint == 1){
			
			if (positionV < foodEnd1){
				moveObjVert(timeInc*3.2,"#food");
				moveObjHor(timeInc*2,"#food");}
				
			if(positionV >= foodEnd1){
				onDelivery();
				landing = landing - 1;
		
				if(landing == 0){
					nextTrial(foodVStart,foodHStart);
					landing = landingMax;}
			}
		}

		
		if (decisionPoint == 2){
			
			if (positionV < foodEnd2){
				moveObjVert(timeInc*3,"#food");
				moveObjHor(-timeInc*2,"#food");}
			
			if (positionV >= foodEnd2){
				onDelivery();
				landing = landing - 1;
		
				if (landing == 0){
					nextTrial(foodVStart,foodHStart);
					landing = landingMax;}
			}
		}
		
		if(decisionPoint == 0){
			noFood(maxFallPos, 19);
			
			if(positionV >= maxFallPos){
				landing = landing - 1;
		
				if(landing == 0){
					nextTrial(foodVStart,foodHStart);
					landing = landingMax;}
			}
		}
	}
});	

//Event function that moves the paddle
	//Set key to random number so we don't get warnings if user doesnt press a button
	key = 222;
	
	$(document).keypress(function(event) {
	
	if (event.keyCode == '37'){ //If user presses left Arrow
		key = 0;
		movePaddle();}
	
	else if(event.keyCode == '39'){ // If user presses right Arrow
		key = 1;
		movePaddle();}
		
	});
});

</script>
<p>TO DO: 1)Add mad/happy lion/zebra pics <br> 2)Add squished food pics</p>
<p id = "Instructions"> Instructions:<br/> Left and Right Arrows govern paddle movement<br/> Get the right food to the right animal<br/> Have Fun!!</p>
</body>
</html>



