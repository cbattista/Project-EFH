<html>
<head>
<link href = "Sdef.css" rel="stylesheet" type = "text/css"> </link>

<script type = "text/javascript" src = "Jquery.js"> </script>
<script type = "text/javascript" src = "timer.js"></script>
<script type = "text/javascript" src = "Subject.js"></script>
</head>

<body>

<h1> Satellite Defender - Click to make stuff a splode</h1>

<div id = "playground">

	<div id = "mysteryBox"> <img src = "images/SatDef/mysteryBox.png"/></div>
	
	<div id = "binoculars" ><img src = "images/SatDef/binocular.png" /></div>
	
	<div id = "city" ><img src = "images/SatDef/city.png" /></div>

</div>

<script type = "text/javascript">

var timeInc = 5;
var boxpos = 0;
var detonated = 0;
var burnout = 10;
var landing = 10;
var landed = 0;

function hitGround() {
	landed = 1;
	landing = 10;
	
	//package hits ground, determine whether it's a good or bad outcome, logs event
	if (stim == 0) {
		subject.inputData(trial, "outcome", "TN");
		$('#city').html("<img src = \"images/SatDef/explosion.png\"/><img src = \"images/SatDef/city.png\"/><img src = \"images/SatDef/explosion.png\"/>");
		//alert('BOOM!');
	}
	else {
		subject.inputData(trial, "outcome", "N");
		//alert('yay');
	}
	subject.inputData(trial, "RT", 0);
	
}

function detonate() {
	detonated = 1;
	//user destroys package
	RT = currentTime.getTime() - trialStart;
	subject.inputData(trial, "RT", RT);

	$('#mysteryBox').html("<img src = \"images/SatDef/explosion.png\"/>")

	if (stim == 0) {
		subject.inputData(trial, "outcome", "P");
	}
	else {
		subject.inputData(trial, "outcome", "FP");
	}
	
}

function nextTrial() {
	$('#mysteryBox').html("<img src = \"images/SatDef/mysteryBox.png\"/>")
	$('#city').html("<img src = \"images/SatDef/city.png\"/>");

	trial = trial + 1;
	if (trial <= stimList.length) {
		stim = stimList[trial];
		subject.inputData(trial, "stim", stim);
		subject.inputData(trial, "stimFile", stimFile[stim]);
	}
	else {
		//alert('Level Complete');
		subject.sendData();
		nextLevel();
	}
	
	setBox(0);
}

function nextLevel() {
	//stuff for making a new stimList etc...
	//setting of game variables - eventually should be retrieved from the database
	trial = 0;
	stimList = [1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1];
	stimFile = ["bombBox.png", "aidBox.png"];
	//start things off
	stim = stimList[trial];
}

function setBox(h) {
	boxpos = h;
	h = h + "px";
	$("#mysteryBox").css("top", h);
}

function incrementBox(h) {
	boxpos = boxpos + h;
	$("#mysteryBox").css("top", boxpos);
}

$(document).ready(function(){
	//$('#target').toggle();
	currentTime = new Date();
	subject = new Subject(666, "satDef");
	
	//setting of game variables - eventually should be retrieved from the database
	trial = 0;
	stimList = [0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0];
	stimFile = ["bombBox.png", "aidBox.png"];
	trialStart = currentTime.getTime();
	//start things off
	
	stim = stimList[trial];
	
	$.timer(40,function(timer){
		
		incrementBox(timeInc);
		
		//need to check and see if the the package is in the binoculars
		//if ((position.top >= 100) and (position.top <= 200 )) { change picture}


		var position = $("#mysteryBox").position()
		
		
		if (detonated == 0) {
			if (position.top > 90) {
				html = "<img src = \"images/SatDef/" + stimFile[stim]  + "\"/>";
				$("#mysteryBox").html(html);			

			}

			if (position.top > 250) {
				html = "<img src = \"images/SatDef/mysteryBox.png\"/>";
				$("#mysteryBox").html(html);			
			}
		}
				
		else  {
			burnout = burnout - 1;
			if (burnout < 0 ) {
				nextTrial();
				burnout = 10;
				detonated = 0;
			}
		}
		
		if (landed == 0) {
			if (position.top > 500){
				landed= 1;
				hitGround();
			}
		}
		else {
			landing = landing - 1;
			if (landing < 0) {
				nextTrial();
				landing = 10;
				landed = 0;
			}
		}		
		
	});

	$("#playground").click(
		function(event) {
			event.preventDefault();
			//probably should make this button specific at some point
			detonate();
			//}
		}
	);	
	
});

</script>


</body>
</html>