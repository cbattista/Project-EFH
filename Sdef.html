<html>
<head>
<link href = "Sdef.css" rel="stylesheet" type = "text/css"> </link>

<script type = "text/javascript" src = "Jquery.js"> </script>
<script type = "text/javascript" src = "timer.js"></script>
<script type = "text/javascript" src = "Subject.js"></script>
<script type = "text/javascript">

var timeInc = 5;

function hitGround() {
	//package hits ground, determine whether it's a good or bad outcome, logs event
	if (stim == 0) {
		subject.inputData(trial, "outcome", "TN");
	}
	else {
		subject.inputData(trial, "outcome", "N");
	}
	subject.inputData(trial, "RT", 0);
	
	advance();

}

function detonate() {
	//user destroys package
	RT = currentTime.getTime() - trialStart;
	subject.inputData(trial, "RT", RT);
	if (stim == 0) {
		subject.inputData(trial, "outcome", "P");
	}
	else {
		subject.inputData(trial, "outcome", "FP");
	}
	
	advance();
	
}

function advance() {
	trial = trial + 1;
	if (trial <= stimList.length) {
		stim = stimList[trial];
		subject.inputData(trial, "stim", stim);
		subject.inputData(trial, "stimFile", stimFile[stim]);
	}
	else {
		alert('Level Complete');
		subject.sendData();
		nextLevel();
	}
}

function nextLevel() {
	//stuff for making a new stimList etc...
	//setting of game variables - eventually should be retrieved from the database
	trial = 0;
	stimList = [1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1];
	stimFile = ["bombBox.png", "aidBox.png"];
	//start things off
	stim = stimList[trial];
}

$(document).ready(function(){

	currentTime = new Date();
	subject = new Subject(666, "satDef");
	
	//setting of game variables - eventually should be retrieved from the database
	trial = 0;
	stimList = [0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0];
	stimFile = ["bombBox.png", "aidBox.png"];
	trialStart = currentTime.getTime();
	//start things off
	stim = stimList[trial];
	
	$.timer(40,function(timer){
		
		var position = $("#mysteryBox").position()
		position.top = position.top + timeInc;
		var positionString = position.top + "px";
		$("#mysteryBox").css("top", positionString);

		//need to check and see if the the package is in the binoculars
		//if ((position.top >= 100) and (position.top <= 200 )) { change picture}
		
		if (position.top > 565){
			position.top = 0;
			hitGround();
		}
			
	});

	$.bind('keypress', 
		function(event) {
			//probably should make this button specific at some point
			//if (event.which == "SPACE") {
				detonate();
			//}
		}
	);	
});

</script>

</head>

<body>
<h1> Satellite Defender </h1>

<div id = "playground">
	<div id = "mysteryBox"> <img src = "images/SatDef/mysteryBox.png" /></div>
	
	<div id = "binoculars" ><img src = "images/SatDef/binocular.png" /></div>
	
	<div id = "city" ><img src = "images/SatDef/city.png" /></div>

</div>

</body>
</html>